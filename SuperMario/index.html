<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Super Mario</title>
    <link href="Style/MarioStyle.css" rel="stylesheet" />
    <script src="kinetic.min.js"></script>
</head>
<body>
    <!--We need svg tag <foreignobject> if we want to use svg and canvas together-->
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xhtml="http://www.w3.org/1999/xhtml" width="1000" height="600">
        <title>markup for Canvas in SVG</title>
        <image id="background" width="1600" height="600" x="0" y="0" xlink:href="Images/background.jpg" />
        <foreignObject width="1000" height="600">
            <xhtml:canvas width="1000" height="600" id="container">
                Your browser does not support canvas
            </xhtml:canvas>
        </foreignObject>
    </svg>

    <audio controls autoplay loop>
        <source src="Sounds/Overworld.mp3" type="audio/mpeg" />
        Your browser does not support the audio element.
    </audio>

    <script>
        var stage = new Kinetic.Stage({
            container: 'container',
            width: 1000,
            height: 600
        });
        
        var backgroundLayer = new Kinetic.Layer();
        var backgroundImage = new Image();
        backgroundImage.onload = function () {
            var bg = new Kinetic.Image({
                x: 0,
                y: -28,
                image: backgroundImage
            });
            backgroundLayer.add(bg);
            stage.add(backgroundLayer);
        };
        backgroundImage.src = 'Images/background2.png';
        

        var layer = new Kinetic.Layer();

        var imageObj = new Image();
        imageObj.onload = function () {
            var mario = new Kinetic.Sprite({
                x: 10,
                y: 390,
                image: imageObj,
                animation: 'stay',
                animations: {
                    walk: [
                      // x, y, width, height (2 frames)
                      0, 0, 50, 150,
                      50, 0, 50, 150
                    ],
                    stay: [
                        0, 0, 50, 150
                    ],
                    jump: [
                        100, 70, 50, 150
                    ]
                },
                frameRate: 7,
                frameIndex: 0
            });

            layer.add(mario);

            stage.add(layer);

            mario.start();

            var frameCount = 0;

            mario.on('frameIndexChange', function (evt) {
                if ((mario.animation() === 'walk' || mario.animation() === 'jump') && ++frameCount > 2) {
                    mario.move({
                        x: 10,
                        y: 0
                    });
                    mario.animation('stay');
                    frameCount = 0;
                }
            });

            document.body.addEventListener('keydown', function (ev) {
                if (ev.keyCode === 39) {
                    mario.animation('walk');
                } else if (ev.keyCode === 38) {
                    mario.animation('jump');
                }
            }, false);

        };
        imageObj.src = 'Images/mario1.png';

    </script>
</body>
</html>
