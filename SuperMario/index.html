<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Super Mario</title>
    <script src="kinetic.min.js"></script>
</head>
<body>
    <div id="container"></div>
    <script>
        var stage = new Kinetic.Stage({
            container: 'container',
            width:1280,
            height: 800
        });
        var layer = new Kinetic.Layer();

        var imageObj = new Image();
        imageObj.onload = function () {
            var mario = new Kinetic.Sprite({
                x: 0,
                y: 0,
                image: imageObj,
                animation: 'stay',
                animations: {
                    walk: [
                      // x, y, width, height (2 frames)
                      0, 0, 50, 150,
                      50, 0, 50, 150
                    ],
                    stay: [
                        0, 0, 50, 150
                    ],
                    jump: [
                        100, 0, 50, 150
                    ]
                },
                frameRate: 7,
                frameIndex: 0
            });

            layer.add(mario);

            stage.add(layer);

            mario.start();

            var frameCount = 0;

            mario.on('frameIndexChange', function (evt) {
                if ((mario.animation() === 'walk') && ++frameCount > 2) {
                    mario.animation('stay');
                    frameCount = 0;
                }
                else if ((mario.animation() === 'jump') && ++frameCount > 2){
                    mario.animation('stay');
                    frameCount = 0;
                }
            });

            function onKeyDown(ev) {
                if (ev.keyCode === 39) {
                    mario.animation('walk');
                } else if(ev.keyCode === 38) {
                    mario.animation('jump');
                } else if (ev.keyCode === 40) {
                    mario.animation('stay');
                }
            }

            document.body.addEventListener('keydown', onKeyDown, false);
            
        };
        imageObj.src = 'mario1.png';

    </script>
</body>
</html>
